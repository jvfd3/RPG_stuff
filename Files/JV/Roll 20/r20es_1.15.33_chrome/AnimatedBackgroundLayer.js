!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=100)}({10:function(e,n,t){"use strict";n.__esModule=!0;var r=t(2),i=t(6),o=function(){function e(e,n,t){var i=this;this.success=!1,this.getRoot=function(){return i._root},this.getId=function(){return i._id},this.isSuccessful=function(){return i.success},this.setData=function(e){return i.returnData=e},window.r20esDialogId="r20esDialogId"in window?window.r20esDialogId:0,this.centerWorkaround=null!==t&&void 0!==t&&t,this._id="r20es-dialog-"+window.r20esDialogId++,this._root=r.DOM.createElement("dialog",{className:e,style:n,id:this.getId()}),document.body.insertBefore(this.getRoot(),document.body.firstElementChild),window.dialogPolyfill&&window.dialogPolyfill.registerDialog(this.getRoot()),this.close=this.close.bind(this),this.dispose=this.dispose.bind(this)}return e.prototype.internalRender=function(){var e=this;this.getRoot().appendChild(this.render()),window.dialogPolyfill&&window.dialogPolyfill.reposition(this.getRoot()),this.centerWorkaround&&setTimeout(function(){e.recenter()},100)},e.prototype.recenter=function(){var e=this.getRoot(),n=document.body.scrollTop||document.documentElement.scrollTop,t=n+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(n,t)+"px"},e.prototype.rerender=function(){i.removeAllChildren(this.getRoot()),this.internalRender()},e.prototype.internalShow=function(){i.removeAllChildren(this.getRoot()),this.success=!1,this.internalRender(),this.getRoot().showModal()},e.prototype.getData=function(){var e=this.returnData;return this.returnData=null,e},e.prototype.close=function(e){void 0===e&&(e=!1),this.success="boolean"==typeof e&&e,this.getRoot().open&&this.getRoot().close()},e.prototype.dispose=function(){this.close(),i.findByIdAndRemove(this.getId())},e}();n.DialogBase=o},100:function(e,n,t){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};n.__esModule=!0;var o=t(4),a=t(5),s=t(2),u=t(77),c=t(7),l=t(78),d=t(12),f=t(10),p=t(11),g=t(79),h=t(6),m=function(){function e(){}return e.get_video_source=function(e){var n=e.attributes[w.propVideoSource];return"string"!=typeof n?"":n},e.get_main_canvas=function(){var e=$("#maincanvas")[0]||$("#finalcanvas")[0];return e||console.error("[AnimatedBackgrounds] could not find beforeRoot!"),e},e.get_canvas_root_size=function(n){if(void 0===n&&(n=void 0),n||(n=e.get_main_canvas()),!n)return{x:0,y:0};var t=n.parentElement;return{x:parseInt(t.style.width.replace("px","")),y:parseInt(t.style.height.replace("px",""))}},e.is_anim_enabled=function(e){var n=e.attributes[w.propVideoEnabled];return"boolean"==typeof n&&n},e.set_anim_enabled=function(e,n){var t;e.save(((t={})[w.propVideoEnabled]=n,t))},e.set_video_source=function(e,n){var t;return e.save(((t={})[w.propVideoSource]=n,t))},e}(),v=function(){function e(){var e=this;this.on_setting_change=function(n,t,r){"muteAudio"===n&&e.video&&(e.video.muted=r),"audioVolume"===n&&e.video&&e.set_volume(r)},this.on_zoom=function(n){console.log("video SET ZOOM",n),e.ctx&&(e.ctx.restore(),e.ctx.save(),e.ctx.scale(n,n))},this.init=function(n,t){e.ctx=t.getContext("2d"),e.ctx.save(),e.video=s.DOM.createElement("video",{loop:!0,autoplay:!0,muted:n.muteAudio}),e.set_volume(n.audioVolume)},this.can_play=function(e){return m.get_video_source(e).length>0&&m.is_anim_enabled(e)},this.render_frame=function(n,t,r,i){if(e.ctx&&e.video){var o=70*n.attributes.width,s=70*n.attributes.height,u=l.scaleToFit(e.video.videoWidth,e.video.videoHeight,o,s);e.ctx.drawImage(e.video,-a.R20.getCanvasOffsetX(),-a.R20.getCanvasOffsetY(),u.x,u.y);var c=Math.ceil(a.R20.getCanvasWidth()/a.R20.getCanvasZoom()),d=a.R20.getCanvasHeight()/a.R20.getCanvasZoom();return e.ctx.fillStyle=n.attributes.background_color,e.ctx.fillRect(0,u.y-a.R20.getCanvasOffsetY(),c,d),e.ctx.fillRect(u.x-a.R20.getCanvasOffsetX(),0,c,d),!0}return!1},this.start=function(n,t){e.video.src=m.get_video_source(n),e.video.play()},this.end=function(n){n.style.display="none",e.video.pause(),e.video.src=""},this.dispose=function(){e.ctx&&(e.ctx=null),e.video&&(e.video=null)}}return e.prototype.set_volume=function(e){if(this.video)try{this.video.volume=e}catch(e){this.video.volume=.1}},e}(),w=function(n){function t(){var r=n.call(this,e)||this;return r._isPlaying=!1,r._events=[],r.render_loop=function(e){r._isPlaying&&r.current_page&&r.current_runner&&r.current_runner.render_frame(r.current_page,r.canvas,r.roll20Canvas,e)&&requestAnimationFrame(r.render_loop)},r.beginVideo=function(){if(r.current_runner){console.log("[AnimBackgrounds] beginVideo while current_runner"),r._isPlaying=!0,r.canvas.style.display="block";var e=function(){try{r.current_runner.start(r.current_page,r.canvas),console.log("[AnimBackgrounds] current_runner.start succeeded!")}catch(e){console.error(e)}};if(e(),d.isChromium())for(var n=["mousedown","scroll","keydown"],t=function(){e();for(var r=0,i=n;r<i.length;r++){var o=i[r];document.body.removeEventListener(o,t)}},i=0,o=n;i<o.length;i++){var s=o[i];document.body.addEventListener(s,t)}r.onResizeCanvas(a.R20.getCanvasWidth(),a.R20.getCanvasHeight()),r.onSetZoom(a.R20.getCanvasZoom()),requestAnimationFrame(r.render_loop),a.R20.renderAll()}else r.err_report_missing_current_runner_in("beginVideo")},r.onPropChange=function(){r.current_runner&&(console.log("[AnimBackgrounds] onPropChange while current_runner"),r.endVideo(),r.current_runner.can_play(r.current_page)&&r.beginVideo())},r.initPage=function(){r.cleanupPage();var e=a.R20.getCurrentPage(),n=function(){return e};r._events=[c.EventSubscriber.subscribe("change:"+t.propVideoSource,r.onPropChange,n),c.EventSubscriber.subscribe("change:"+t.propVideoEnabled,r.onPropChange,n),c.EventSubscriber.subscribe("change:height",r.onPropChange,n),c.EventSubscriber.subscribe("change:width",r.onPropChange,n)],r.current_page=e,a.R20.renderAll(),r.canvas=s.DOM.createElement("canvas",null);var i=m.get_main_canvas();i&&(i.parentNode.insertBefore(r.canvas,i),r.canvas.width=i.width,r.canvas.height=i.height,r.roll20Canvas=i);var o=r.getHook().config;r.current_runner=new v,r.current_runner.init(o,r.canvas),r.current_runner&&r.current_runner.can_play(r.current_page)&&r.beginVideo()},r.onResizeCanvas=function(e,n){r._isPlaying&&(console.log("[AnimBackgrounds] onResizeCanvas while _isPlaying"),r.canvas.width=e,r.canvas.height=n,r.onSetZoom(a.R20.getCanvasZoom()))},r.overrideSetCanvasSize=function(e,n){r._originalResize(e,n),r.onResizeCanvas(e,n)},r.onSetZoom=function(e){r._isPlaying&&(console.log("[AnimBackgrounds] onSetZoom while _isPlaying"),r.current_runner.on_zoom(e))},r.ui_show_configuration_dialog=function(){r._dialog.show(r,r.current_page)},r.trampoline_draw_background=function(e,n){if(r._isPlaying){var t=e.fillStyle,i=e.globalCompositeOperation;e.fillStyle="rgba(0,0,0,0)",e.globalCompositeOperation="copy";var o=a.R20.getCanvasZoom();e.fillRect(0,0,Math.ceil(a.R20.getCanvasWidth()/o),Math.ceil(a.R20.getCanvasHeight()/o)),e.fillStyle=t,e.globalCompositeOperation=i}else r.original_canvas_overlay_draw_background(e,n)},r}return r(t,n),t.prototype.err_report_missing_current_runner_in=function(e){console.error("["+e+"]: current_runner is null, bailing.")},t.prototype.endVideo=function(){this.current_runner?(console.log("[AnimBackgrounds] endVideo while current_runner"),this._isPlaying=!1,this.current_runner.end(this.canvas),a.R20.renderAll()):this.err_report_missing_current_runner_in("endVideo")},t.prototype.cleanupPage=function(){console.log("[AnimBackgrounds] cleanupPage"),this.endVideo();for(var e=0,n=this._events;e<n.length;e++){n[e].unsubscribe()}this.current_runner&&this.current_runner.dispose(),this.canvas&&(this.canvas.remove(),this.canvas=null)},t.prototype.onSettingChange=function(e,n,t){this.current_runner&&(console.log("[AnimBackgrounds] onSettingChange while current_runner"),this.current_runner.on_setting_change(e,n,t))},t.prototype.setup=function(){if(console.log("video before =================================="),this._originalResize=window.d20.engine.setCanvasSize,window.d20.engine.setCanvasSize=this.overrideSetCanvasSize,window.r20es.onZoomChange=this.onSetZoom,window.r20es.onResizeCanvas=this.onResizeCanvas,this.original_canvas_overlay_draw_background=window.d20.canvas_overlay.drawBackground,window.d20.canvas_overlay.drawBackground=this.trampoline_draw_background,this.initPage(),window.r20es.onPageChange.on(this.initPage),a.R20.isGM()){this._showSettingsWidget=s.DOM.createElement("div",{title:"Animated Background Setup (VTTES)",style:{cursor:"pointer",position:"absolute",top:"0",right:"400px",maxWidth:"32px",maxHeight:"32px",zIndex:"10",backgroundColor:"#e18e42",borderRadius:"2px"},onClick:this.ui_show_configuration_dialog},s.DOM.createElement("img",{src:"https://github.com/encharm/Font-Awesome-SVG-PNG/raw/master/black/png/32/film.png",width:"28",height:"28",alt:"ANIM"})),document.body.appendChild(this._showSettingsWidget),console.log(this._showSettingsWidget)}this._dialog=new y},t.prototype.dispose=function(){n.prototype.dispose.call(this),this.cleanupPage(),window.d20.engine.setCanvasSize=this._originalResize,window.r20es.onZoomChange=null,window.r20es.onResizeCanvas=null,window.d20.canvas_overlay.drawBackground=this.original_canvas_overlay_draw_background,this.original_canvas_overlay_draw_background=null,this._showSettingsWidget.remove(),this._showSettingsWidget=null,this._dialog.dispose(),this.current_runner&&this.current_runner.dispose,window.r20es.onPageChange.off(this.initPage)},t.propVideoSource="r20es_video_src",t.propVideoEnabled="r20es_video_enabled",t}(o.R20Module.OnAppLoadBase),_=function(e,n,t){var r=document.createElement("video");r.crossorigin="anonymous",r.volume=0;var i=function(){r.pause(),r.removeEventListener("error",o),r.removeEventListener("canplay",a),r.src=""},o=function(e){i(),console.error("check_if_url_is_video_stream error:",e),t()},a=function(e){i(),n()};r.addEventListener("error",o),r.addEventListener("canplay",a),r.src=e,console.log(e),r.play()},y=function(e){function n(){var n=e.call(this)||this;return n.onChangeEnabled=function(e){m.set_anim_enabled(n.page,e.target.checked)},n.ui_is_invalid_media_url=!1,n.onBlurUrl=function(e){e.stopPropagation(),n.ui_on_update_url_input(e.target.value)},n.ui_on_update_url_input=function(e){m.set_video_source(n.page,e),n.ui_verify_media_url(e,!0)},n.module_get_history=function(){return n.parent_module.getHook().config.video_history},n.module_save_history=function(e){return n.parent_module.setConfigValue("video_history",e)},n.ui_verify_media_url=function(e,t){_(e,function(){if(t){var r=n.module_get_history();g.removeByReference(r,e),r.unshift(e),n.module_save_history(r)}n.ui_is_invalid_media_url=!1,n.rerender()},function(){n.ui_is_invalid_media_url=!0,n.rerender()})},n.ui_toggle_history=function(){n.show_history=!n.show_history,n.rerender()},n.show_history=!1,n.ui_history_url_attrib="url",n.ui_history_retrieve_url=function(e){return e.target.getAttribute(n.ui_history_url_attrib)},n.ui_history_remove=function(e){var t=n.ui_history_retrieve_url(e),r=n.module_get_history();g.removeByReference(r,t),n.module_save_history(r),n.rerender()},n.ui_history_select=function(e){var t=n.ui_history_retrieve_url(e);n.ui_on_update_url_input(t)},n}return r(n,e),n.prototype.show=function(e,n){this.parent_module=e,this.page=n,this.internalShow(),this.ui_verify_media_url(m.get_video_source(n),!1)},n.prototype.render=function(){var e=this,n=this.module_get_history(),t=[],r=m.is_anim_enabled(this.page),o=m.get_video_source(this.page);if(this.show_history){for(var a=function(n,t){return n.setAttribute(e.ui_history_url_attrib,t)},c=0,l=n;c<l.length;c++){var d=l[c],f={width:"auto",marginRight:"8px"},g=s.DOM.createElement("input",{style:f,className:"btn btn-danger",type:"button",value:"X",onClick:this.ui_history_remove}),v=s.DOM.createElement("input",{style:f,className:"btn btn-success",type:"button",value:"Use",onClick:this.ui_history_select}),w=s.DOM.createElement("span",{title:d},h.nearly_format_file_url(d));a(g,d),a(v,d),t.push(s.DOM.createElement("div",null,g,v,w))}0==n.length&&t.push(s.DOM.createElement("div",null,"Nothing here!"))}var _=s.DOM.createElement("span",null);return this.ui_is_invalid_media_url?(s.DOM.apply_style(_,i({float:"right"},u.CommonStyle.error_span)),_.innerText="Invalid: Not a direct video stream"):(s.DOM.apply_style(_,i({float:"right"},u.CommonStyle.success_span)),_.innerText="URL is valid!"),s.DOM.createElement(p.Dialog,null,s.DOM.createElement(p.DialogHeader,null,s.DOM.createElement("h2",null,"Animated Background Setup")),s.DOM.createElement(p.DialogBody,null,s.DOM.createElement("div",null,s.DOM.createElement("i",null,"Disclaimer: Players must have VTTES installed to be able to see the animated background.")),s.DOM.createElement("br",null),s.DOM.createElement("div",{style:{display:"grid",gridTemplateColumns:"auto auto",rowGap:"4px"}},s.DOM.createElement("b",null,"Enabled?"),s.DOM.createElement("div",null,s.DOM.createElement("input",{type:"checkbox",onChange:this.onChangeEnabled,checked:r})),s.DOM.createElement("span",null,s.DOM.createElement("b",null,"Media URL "),s.DOM.createElement("i",null,"(must be a direct stream)")),s.DOM.createElement("div",null,s.DOM.createElement("input",{style:{paddingLeft:"8px"},type:"text",onBlur:this.onBlurUrl,value:o}))),s.DOM.createElement("div",null,_),s.DOM.createElement("br",null),s.DOM.createElement("button",{style:"btn",onClick:this.ui_toggle_history},this.show_history?"Hide History":"Show History"),s.DOM.createElement("br",null),s.DOM.createElement("div",{style:{maxHeight:"500px",overflowY:"auto"}},t)),s.DOM.createElement(p.DialogFooter,null,s.DOM.createElement(p.DialogFooterContent,null,s.DOM.createElement("button",{style:{boxSizing:"border-box",width:"100%"},className:"btn btn-primary",onClick:this.close},"OK"))))},n}(f.DialogBase);o.R20Module.canInstall()&&(new w).install()}).call(this,"src/modules/AnimatedBackgroundLayer")},11:function(e,n,t){"use strict";var r=this&&this.__extends||function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();n.__esModule=!0;var i=t(2),o=t(6),a=function(e){function n(n,t,r){var o=e.call(this,t,r)||this;return o.show=o.internalShow,o.render=function(){return i.DOM.createElement(u,null,i.DOM.createElement(s,null,i.DOM.createElement("h3",null,o.action,", please wait...")))},o.action=n,o}return r(n,e),n}(t(10).DialogBase);function s(e){return i.DOM.createElement("div",{className:"dialog-body"})}function u(e){return i.DOM.createElement("div",{className:"r20es-dialog"})}n.LoadingDialog=a,n.DialogHeader=function(e){return i.DOM.createElement("div",{className:"dialog-header"})},n.DialogBody=s,n.DialogFooter=function(e){return i.DOM.createElement("div",{className:"dialog-footer"},i.DOM.createElement("hr",null))},n.DialogFooterContent=function(e){return i.DOM.createElement("div",{className:"dialog-footer-content"})},n.Dialog=u,n.CheckboxWithText=function(e){var n=o.copy(e,{style:{verticalAlign:"middle",marginRight:"4px"},type:"checkbox"}),t=i.DOM.createElement("input",n),r=n&&n.component||"div";return i.DOM.createElement(r,null,t,i.DOM.createElement("span",{style:{verticalAlign:"middle"}},n.checkboxText))}},12:function(e,n,t){"use strict";n.__esModule=!0;var r=t(13),i=function(){var e=r.default();return"chrome"===e.name||"opera"===e.name};n.isChromium=i;n.doesBrowserNotSupportResponseFiltering=function(){var e=r.default();return console.log(e),!!i()||"firefox"===e.name&&e.versionNumber<57}},13:function(e,n,t){"use strict";t.r(n),function(e){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},r=[["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["edge",/Edge\/([0-9\._]+)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["safari",/Version\/([0-9\._]+).*Safari/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/]],i=["Windows Phone","Android","CentOS",{name:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],o={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},a=new RegExp(["(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|","compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|","midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)","\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|","wap|windows ce|xda|xiino"].join(""),"i"),s=new RegExp(["1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|","ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|","avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|","cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|","ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|","g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|","hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|","i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|","kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])","|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|","mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|","n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|","op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|","po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|","raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|","se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|k\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|","so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|","tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|","veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|","w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-"].join(""),"i"),u=function(){function e(e,n,t){this.navigator=n,this.process=t,this.userAgent=e||(this.navigator?n.userAgent||n.vendor:"")}return e.prototype.detect=function(){if(this.process&&!this.userAgent){var e=this.process.version.slice(1).split(".").slice(0,3),n=Array.prototype.slice.call(e,1).join("")||"0";return{name:"node",version:e.join("."),versionNumber:parseFloat(e[0]+"."+n),mobile:!1,os:this.process.platform}}return this.userAgent||this.handleMissingError(),t({},this.checkBrowser(),this.checkMobile(),this.checkOs())},e.prototype.checkBrowser=function(){var e=this;return r.filter(function(n){return n[1].test(e.userAgent)}).map(function(n){var t=n[1].exec(e.userAgent),r=t&&t[1].split(/[._]/).slice(0,3),i=Array.prototype.slice.call(r,1).join("")||"0";return r&&r.length<3&&Array.prototype.push.apply(r,1===r.length?[0,0]:[0]),{name:String(n[0]),version:r.join("."),versionNumber:Number(r[0]+"."+i)}}).shift()},e.prototype.checkMobile=function(){var e=this.userAgent.substr(0,4);return{mobile:a.test(this.userAgent)||s.test(e)}},e.prototype.checkOs=function(){var e=this;return i.map(function(n){var t=n.name||n,r=e.getOsPattern(n);return{name:t,pattern:r,value:RegExp("\\b"+r.replace(/([ -])(?!$)/g,"$1?")+"(?:x?[\\d._]+|[ \\w.]*)","i").exec(e.userAgent)}}).filter(function(e){return e.value}).map(function(e){var n,t=e.value[0]||"";return e.pattern&&e.name&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(n=o[t.replace(/[^\d.]/g,"")])&&(t="Windows "+n),e.pattern&&e.name&&(t=t.replace(RegExp(e.pattern,"i"),e.name)),t=t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0].trim(),{os:t=/^(?:webOS|i(?:OS|P))/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1)}}).shift()},e.prototype.getOsPattern=function(e){var n=e;return("string"==typeof e?e:void 0)||n.pattern||n.name},e.prototype.handleMissingError=function(){throw new Error("Please give user-agent.\n> browser(navigator.userAgent or res.headers['user-agent']).")},e}();function c(e,n){return e(n={exports:{}},n.exports),n.exports}var l=c(function(e){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)}),d=c(function(e){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)}),f=(d.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),p=function(e){if(!f(e))throw TypeError(e+" is not an object!");return e},g=function(e){try{return!!e()}catch(e){return!0}},h=!g(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),m=l.document,v=f(m)&&f(m.createElement),w=!h&&!g(function(){return 7!=Object.defineProperty(function(e){return v?m.createElement(e):{}}("div"),"a",{get:function(){return 7}}).a}),_=Object.defineProperty,y={f:h?Object.defineProperty:function(e,n,t){if(p(e),n=function(e,n){if(!f(e))return e;var t,r;if(n&&"function"==typeof(t=e.toString)&&!f(r=t.call(e)))return r;if("function"==typeof(t=e.valueOf)&&!f(r=t.call(e)))return r;if(!n&&"function"==typeof(t=e.toString)&&!f(r=t.call(e)))return r;throw TypeError("Can't convert object to primitive value")}(n,!0),p(t),w)try{return _(e,n,t)}catch(e){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(e[n]=t.value),e}},b=h?function(e,n,t){return y.f(e,n,function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}}(1,t))}:function(e,n,t){return e[n]=t,e},C={}.hasOwnProperty,O=function(e,n){return C.call(e,n)},S=0,k=Math.random(),M=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++S+k).toString(36))},x=c(function(e){var n=M("src"),t=Function.toString,r=(""+t).split("toString");d.inspectSource=function(e){return t.call(e)},(e.exports=function(e,t,i,o){var a="function"==typeof i;a&&(O(i,"name")||b(i,"name",t)),e[t]!==i&&(a&&(O(i,n)||b(i,n,e[t]?""+e[t]:r.join(String(t)))),e===l?e[t]=i:o?e[t]?e[t]=i:b(e,t,i):(delete e[t],b(e,t,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[n]||t.call(this)})}),E=function(e,n,t){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===n)return e;switch(t){case 1:return function(t){return e.call(n,t)};case 2:return function(t,r){return e.call(n,t,r)};case 3:return function(t,r,i){return e.call(n,t,r,i)}}return function(){return e.apply(n,arguments)}},T=function(e,n,t){var r,i,o,a,s=e&T.F,u=e&T.G,c=e&T.S,f=e&T.P,p=e&T.B,g=u?l:c?l[n]||(l[n]={}):(l[n]||{}).prototype,h=u?d:d[n]||(d[n]={}),m=h.prototype||(h.prototype={});for(r in u&&(t=n),t)o=((i=!s&&g&&void 0!==g[r])?g:t)[r],a=p&&i?E(o,l):f&&"function"==typeof o?E(Function.call,o):o,g&&x(g,r,o,e&T.U),h[r]!=o&&b(h,r,a),f&&m[r]!=o&&(m[r]=o)};l.core=d,T.F=1,T.G=2,T.S=4,T.P=8,T.B=16,T.W=32,T.U=64,T.R=128;var D=T,R={}.toString,P=function(e){return R.call(e).slice(8,-1)},A=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==P(e)?e.split(""):Object(e)},I=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},j=Math.ceil,B=Math.floor,L=Math.min,N=function(e){return e>0?L(function(e){return isNaN(e=+e)?0:(e>0?B:j)(e)}(e),9007199254740991):0},F=Array.isArray||function(e){return"Array"==P(e)},U=c(function(e){var n=l["__core-js_shared__"]||(l["__core-js_shared__"]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:d.version,mode:"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})}),z=c(function(e){var n=U("wks"),t=l.Symbol,r="function"==typeof t;(e.exports=function(e){return n[e]||(n[e]=r&&t[e]||(r?t:M)("Symbol."+e))}).store=n})("species"),$=function(e,n){return new(function(e){var n;return F(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!F(n.prototype)||(n=void 0),f(n)&&null===(n=n[z])&&(n=void 0)),void 0===n?Array:n}(e))(n)},H=function(e,n){var t=1==e,r=2==e,i=3==e,o=4==e,a=6==e,s=5==e||a,u=n||$;return function(n,c,l){for(var d,f,p=function(e){return Object(I(e))}(n),g=A(p),h=E(c,l,3),m=N(g.length),v=0,w=t?u(n,m):r?u(n,0):void 0;m>v;v++)if((s||v in g)&&(f=h(d=g[v],v,p),e))if(t)w[v]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return v;case 2:w.push(d)}else if(o)return!1;return a?-1:i||o?o:w}},V=function(e,n){return!!e&&g(function(){n?e.call(null,function(){},1):e.call(null)})},W=H(2);D(D.P+D.F*!V([].filter,!0),"Array",{filter:function(e){return W(this,e,arguments[1])}});d.Array.filter;var G=H(1);D(D.P+D.F*!V([].map,!0),"Array",{map:function(e){return G(this,e,arguments[1])}});d.Array.map;var Z="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",J="["+Z+"]",X=RegExp("^"+J+J+"*"),q=RegExp(J+J+"*$"),Y=function(e,n,t){var r={},i=g(function(){return!!Z[e]()||"​"!="​"[e]()}),o=r[e]=i?n(K):Z[e];t&&(r[t]=o),D(D.P+D.F*i,"String",r)},K=Y.trim=function(e,n){return e=String(I(e)),1&n&&(e=e.replace(X,"")),2&n&&(e=e.replace(q,"")),e};Y("trim",function(e){return function(){return e(this,3)}});d.String.trim;var Q="undefined"!=typeof window?window.navigator:void 0,ee=void 0!==e?e:void 0;n.default=function(e){return new u(e,Q,ee).detect()}}.call(this,t(14))},14:function(e,n){var t,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,d=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&p())}function p(){if(!l){var e=s(f);l=!0;for(var n=c.length;n;){for(u=c,c=[];++d<n;)u&&u[d].run();d=-1,n=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(n){try{return r.call(null,e)}catch(n){return r.call(this,e)}}}(e)}}function g(e,n){this.fun=e,this.array=n}function h(){}i.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];c.push(new g(e,n)),1!==c.length||l||s(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},2:function(e,n,t){"use strict";var r,i=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e};n.__esModule=!0,function(e){e.rerender=function(e,n){var t=e.nextSibling,r=e.parentNode;e.remove();var i=n();return t?r.insertBefore(i,t):r.appendChild(i),i},e.createElement=function(n,t){for(var r,a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];var u=null,c="function"==typeof n;c&&n.name&&n.prototype instanceof e.ElementBase?u=new n(t).render():u=c?n(t):document.createElement(n);if(!(u instanceof HTMLElement))return console.error($(o||(o=i(["JSX Render must return a valid element: elem is not an instance of HTMLElement"],["JSX Render must return a valid element: elem is not an instance of HTMLElement"])))),console.table(((r={})['"type" argument']=n,r.Type=typeof u,r.Value=u,r)),console.trace(),null;if(a){var l=document.createDocumentFragment(),d=function(e){for(var n=0,t=e;n<t.length;n++){var r=t[n];if(r instanceof HTMLElement)l.appendChild(r);else if(Array.isArray(r))d(r);else if("number"==typeof r)l.appendChild(document.createTextNode(r.toString()));else if("string"==typeof r)l.appendChild(document.createTextNode(r));else if(null===r||void 0===r||"boolean"==typeof r)console.log("JSX got an unrenderable child value, assuming it's control flow related: type: "+typeof r+" value: "+r+".");else{var i=[];for(var o in r)i.push(r[o]);d(i)}}};d(a),u.appendChild(l)}var f=function(e){return e.startsWith("on")},p=function(e){return e.substring(2).toLowerCase()};for(var g in t)if(t.hasOwnProperty(g)){var h=t[g];if(f(g))u.addEventListener(p(g),h);else if("className"===g)if(h&&Array.isArray(h))for(var m=0,v=h;m<v.length;m++){var w=v[m];!w||w.length<=0||u.classList.add(w)}else"string"==typeof h&&h.length>0&&(u.className=u.className&&u.classList.length>0?u.className+" "+h:h);else"style"===g?"string"==typeof h?u.style.cssText=h:"object"==typeof h?e.apply_style(u,h):void 0!==h&&console.error("Unknown style attribute type: "+typeof h+", "+h):g.startsWith("data")?u.setAttribute(g,h):u[g]=h}return u};var n=function(){return function(){var n=this;this.elementRoot=null,this.render=function(){var e=n.internalRender();return n.setRoot(e),e},this.rerender=function(){return e.rerender(n.getRoot(),function(){return n.render()})},this.setRoot=function(e){return n.elementRoot=e},this.getRoot=function(){return n.elementRoot},this.dispose=function(){n.getRoot().remove()}}}();e.ElementBase=n,e.apply_style=function(e,n){for(var t in n)n.hasOwnProperty(t)&&t&&(e.style[t]=n[t])}}(r||(r={})),n.DOM=r;n.SidebarSeparator=function(e){var n=e&&e.big;return r.createElement("div",null,n&&r.createElement("div",{className:"clear",style:{height:n}}),r.createElement("hr",null),n&&r.createElement("div",{className:"clear",style:{height:n}}))};var o;n.SidebarCategoryTitle=function(e){return r.createElement("h3",{style:{marginBottom:"5px",marginLeft:"5px"}})}},3:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=(e=>{const n=e.replace(/\\/g,"/").split("/");if(n.length<=0)throw new Error("Invalid dirname given.");return n[n.length-1]+".js"})},4:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.R20Module=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(t(3));function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n}let a={};n.R20Module=a,a.Base=function(){function e(e){!function(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}(this,"getAllHooks",e=>window.r20es.hooks),this.filename=(0,r.default)(e),this.isDisposed=!0}var n=e.prototype;return n.installFirstTime=function(){},n.installUpdate=function(){},n.dispose=function(){},n.internalCanInstall=function(){return!!this.getHook().config.enabled&&(!!this.isDisposed||(console.error("Attempted to install module when it's not disposed."),console.table({"Module filename":this.filename}),console.trace(),!1))},n.internalInstallFirstTime=function(){if(this.internalCanInstall()){try{this.installFirstTime()}catch(e){console.error(e)}this.isDisposed=!1}},n.internalInstallUpdate=function(){if(this.internalCanInstall()){try{this.installUpdate()}catch(e){console.error(e)}this.isDisposed=!1}},n.internalDispose=function(){if(console.log(this),this.isDisposed)return console.error("internalDispose called on module that is already disposed!"),console.table({"Module filename":this.filename}),void console.trace();try{this.dispose()}catch(e){console.error(e)}this.isDisposed=!0},n.setConfigValue=function(e,n){const t=this.getHook(),r=this.getHook().config;if(!(e in r))return void console.error(`Tried to set config of key ${e} to value ${n} but key was not found in the config of module id ${t.id}"`);const i=r[e];r[e]=n,t.saveConfig(),r.enabled&&"onSettingChange"in this&&"function"==typeof this.onSettingChange&&this.onSettingChange(e,i,n)},n.getHook=function(){if(!1 in window.r20es)return null;for(const e in window.r20es.hooks){const n=window.r20es.hooks[e];if(n.filename&&n.filename===this.filename)return n}return null},n.toggleEnabledState=function(e){const n=this.getHook(),t=void 0===e||null===e?!n.config.enabled:e;if(n.config.enabled&&t)return;const r=n.config.enabled;n.config.enabled=t,n.saveConfig(),r&&!t?(console.log("disabling"),this.internalDispose()):!r&&t&&(console.log("enabling"),this.internalInstallUpdate())},n.install=function(){if(!("r20esInstalledModuleTable"in window))return;if(!("r20esDisposeTable"in window))return;console.log(`Installing module filename: ${this.filename}`),!(this.filename in window.r20esInstalledModuleTable)?(console.log("First run"),this.internalInstallFirstTime()):(this.filename in window.r20esDisposeTable&&console.error(`DUPLICATE MODULE FOUND: ${this.filename}`),console.log("Calling install update"),this.internalInstallUpdate()),window.r20esDisposeTable[this.filename]=(()=>{this.dispose()}),window.r20esInstalledModuleTable[this.filename]=this,console.log(`DONE! module ID: ${this.filename}`)},e}(),a.SimpleBase=function(e){function n(){return e.apply(this,arguments)||this}o(n,e);var t=n.prototype;return t.installFirstTime=function(){this.setup()},t.installUpdate=function(){this.setup()},t.setup=function(){},n}(a.Base),a.OnAppLoadBase=function(e){function n(n){var t;return(t=e.call(this,n)||this).setup=t.setup.bind(i(i(t))),t}o(n,e);var t=n.prototype;return t.installFirstTime=function(){window.r20es.isLoading?(this.earlySetup(),window.r20es.onAppLoad.addEventListener(this.setup)):(this.earlySetup(),this.setup())},t.earlySetup=function(){},t.setup=function(){},t.installUpdate=function(){this.installFirstTime()},t.dispose=function(){window.r20es.onAppLoad.removeEventListener(this.setup)},n}(a.Base),a.canInstall=(e=>window.r20es&&"canInstallModules"in window.r20es&&window.r20es.canInstallModules),a.getModule=function(e){return"r20esInstalledModuleTable"in window?window.r20esInstalledModuleTable[e]:null},a.getModuleById=function(e){return"r20esInstalledModuleTable"in window?a.getModule(window.r20es.hooks[e].filename):null}},5:function(e,n,t){"use strict";n.__esModule=!0;var r,i=t(7);!function(e){var n;function t(){return window.d20.engine.unselect()}function r(e){window.d20.engine.select(e)}function o(){return window.currentPlayer}function a(){return window.currentEditingLayer}function s(){try{var e=window.d20.Campaign.attributes.jukeboxfolder;return JSON.parse(e||"[]")}catch(e){console.error("[getJukeboxFileStructure] failed to get fs due to exception",e)}return[]}function u(e){return window.Jukebox.playlist.get(e)}function c(){return window.d20.Campaign.activePage()}function l(){return window.d20.engine.canvas.getObjects()}function d(n){for(var t=0,r=l();t<r.length;t++){var i=r[t],o=e.try_get_canvas_object_model(i);if(o&&o.get("id")===n)return i}return null}function f(e,n,t){t?($(document).on("mancerroll:"+n,function(e,r){$(document).off("mancerroll:"+n),t(e,r)}),window.d20.textchat.doChatInput(e,"chatbox",n)):window.d20.textchat.doChatInput(e)}function p(e){window.d20.textchat.incoming(!1,{who:"system",type:"system",content:e})}function g(){window.d20.engine.redrawScreenNextTick(!1)}!function(e){e[e.NumericAscending=0]="NumericAscending",e[e.NumericDescending=1]="NumericDescending",e[e.Alphabetical=2]="Alphabetical",e[e.AlphabeticalDescending=3]="AlphabeticalDescending",e[e.Card=4]="Card"}(n=e.InitiativeOrdering||(e.InitiativeOrdering={})),function(e){e.Map="map",e.PlayerTokens="objects",e.GMTokens="gmlayer",e.Lighting="walls",e.B20Foreground="foreground",e.B20Weather="weather",e.B20Background="background"}(e.CanvasLayer||(e.CanvasLayer={})),e.setBackgroundStyle=function(e){window.d20.engine.backgroundColor=e},e.setupImageDropTarget=function(e,n,t){var r={model:{save:n},updateModel:t};window.d20.utils.setupAvatar(e,r)},e.getCanvasMousePos=function(){return window.d20.engine.mousePos.slice()},e.onInitiativeChange=function(n){return new i.EventSubscriber("change:turnorder",n,function(){return e.getInitiativeWindow().model})},e.setCanvasObjectLocation=function(n,t,r){var i=e.try_get_canvas_object_model(n);i&&i.save({top:r,left:t})},e.getBlob=function(e,n,t){return void 0===t&&(t=5e3),new Promise(function(r,i){e._getLatestBlob(n,r),setTimeout(i,t)})},e.getCampaign=function(){return window.Campaign},e.canEditCharacter=function(n){var t=n.attributes.controlledby;return!!e.isGM()||(!!t.includes("all")||!!t.includes(e.getCurrentPlayer().id))},e.getHandout=function(e){return window.Campaign.handouts.get(e)},e.createCharacter=function(e){return window.Campaign.characters.create(e)},e.setCanvasObjectDimensions=function(n,t,r){var i=e.try_get_canvas_object_model(n);i&&i.save({width:t,height:r})},e.getCharacter=function(e){return window.Campaign.characters.get(e)},e.getAllCharacters=function(){return window.Campaign.characters.models},e.getAllPages=function(){return window.Campaign.pages.models},e.createRollableTable=function(e){return window.d20.Campaign.rollabletables.create(e)},e.getRollableTable=function(e){return window.d20.Campaign.rollabletables.get(e)},e.getSelectedTokens=function(){return window.d20.engine.selected()},e.unselectTokens=t,e.addTokenToSelection=r,e.selectToken=function(e){t(),r(e)},e.hideTokenRadialMenu=function(){window.d20.token_editor.removeRadialMenu()},e.hideTokenContextMenu=function(){window.d20.token_editor.closeContextMenu()},e.getCurrentPlayer=o,e.getCanvasZoom=function(){return window.d20.engine.canvasZoom},e.getCanvasWidth=function(){return window.d20.engine.canvas.width},e.getCanvasHeight=function(){return window.d20.engine.canvas.height},e.getCanvasOffsetX=function(){return window.d20.engine.currentCanvasOffset[0]},e.getCanvasOffsetY=function(){return window.d20.engine.currentCanvasOffset[1]},e.getPageById=function(e){return window.Campaign.pages.get(e)},e.isGM=function(){return window.is_gm},e.getCurrentLayer=a,e.generateUUID=function(){return window.generateUUID()},e.getCurrentToolName=function(){return window.d20.engine.mode},e.advanceInitiative=function(){window.d20.Campaign.initiativewindow.nextTurn()},e.addTokenToInitiative=function(e){window.d20.Campaign.initiativewindow.addTokenToList(e)},e.addCustomItemToInitiative=function(e,n){window.d20.Campaign.initiativewindow.addTokenToList("-1",e,n)},e.rerenderMacroBar=function(){window.d20.player_settings.refreshMacroBar()},e.rerenderJournalMacros=function(){window.d20.player_settings.refreshRollsList()},e.orderInitiativeBy=function(e){var t,r=((t={})[n.NumericAscending]=".sortlist_numeric",t[n.NumericDescending]=".sortlist_numericdesc",t[n.Alphabetical]=".sortlist_alpha",t[n.AlphabeticalDescending]=".sortlist_alphadesc",t[n.Card]=".sortlist_card",t);if(e in r){var i=r[e];$("#initiativewindow_settings").dialog({modal:!1,title:"Turn Order Settings",beforeClose:function(){}}),$(i).click()}else console.error("Invalid initiative ordering: "+e)},e.getInitiativeWindow=function(){return window.d20.Campaign.initiativewindow},e.getJukeboxFileStructure=s,e.setJukeboxFileStructure=function(n){e.getCampaign().save({jukeboxfolder:JSON.stringify(n)})},e.createPlaylist=function(e){return window.d20.jukebox.addFolderToFolderStructure(e)},e.addTrackToPlaylist=function(e,n){return window.d20.jukebox.addItemToFolderStructure(e,n)},e.getSongById=u,e.getJukeboxPlaylists=function(){for(var e=[],n=0,t=s();n<t.length;n++){var r=t[n];if("string"!=typeof r){for(var i=r,o={id:i.id,name:i.n,mode:i.s,songs:[]},a=0,c=i.i;a<c.length;a++){var l=c[a],d=u(l);d?o.songs.push(d):console.warn("Tried to get song id "+l+" but the query returned a falsy value. Skipping")}e.push(o)}}return e},e.playAudio=function(e,n){window.Jukebox.soundObjs[e]=window.soundManager.createSound({id:e,url:n})},e.createSong=function(e){return window.Jukebox.playlist.create(e)},e.makePlaylistStructure=function(e,n,t){return{id:window.generateUUID(),n:e,s:n,i:t||[]}},e.getInitiativeData=function(){return window.d20.Campaign.initiativewindow.cleanList()},e.setInitiativeData=function(e){window.d20.Campaign.initiativewindow.model.save({turnorder:JSON.stringify(e)})},e.getCurrentPage=c,e.getCurrentPageTokens=l,e.doesTokenContainMouse=function(e,n){return window.d20.engine.canvas.containsPoint(e,n)},e.getCurrentPageTokenByUUID=d,e.try_get_canvas_object_model=function(e){return e._model?e._model:e.model?e.model:null},e.isUsing5EOGLSheet=function(){try{return window.d20.journal.customSheets.workerScripts[0].includes("5th Edition OGL by Roll20")}catch(e){return!1}},e.moveCameraToTokenByUUID=function(e){if(e){var n=d(e);if(n){var t=$("#editor-wrapper")[0];t.scrollTop=Math.floor(n.top*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasHeight/2)+125*window.d20.engine.canvasZoom,t.scrollLeft=Math.floor(n.left*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasWidth/2)+125*window.d20.engine.canvasZoom}}},e.primitiveSay=function(e,n){window.d20.textchat.doChatInput(e,n)},e.say=f,e.sayToSelf=function(n,t){var r='/w "'+o().get("displayname")+'" '+n;t?f(r,e.generateUUID(),t):f(r)},e.saySystemRaw=p,e.saySystem=function(e){p('<span style="background: rgba(6,26,45,255);\n    color: whitesmoke;\n    border: none;\n    display: inline-block;\n    padding: 8px;\n    margin: -15px -5px -7px -45px;    \n    "\n>\n'+e+"\n</span>\n        ")},e.ping=function(e,n,t,r,i){t=t||o().id,window.d20.engine.pings[t]={left:e,top:n,radius:-5,player:t,pageid:r||c().id,currentLayer:i||a()},window.d20.engine.pinging={downx:e,downy:n},g()},e.getFabric=function(){return window.exports.fabric},e.renderAll=g,e.setGMLayerOpacity=function(e){window.d20.engine.gm_layer_opacity=e},e.hasBetteR20=function(){return void 0!==window.d20plus},e.wipeObjectStorage=function(e){for(var n=e.length,t=0;t<n;t++){var r=e.length-1;if(0>r)break;var i=e.models[r];if(!i||void 0===i)break;i.destroy()}e.length<0&&console.error("FAILED TO WIPE OBJECT STORAGE!")},e.doBulkRoll=function(n,t,r,i,o){e.unselectTokens();var a=function(n){if(e.selectToken(n),o){var r=o(n);r&&e.say(t,r.id,r.callback)}else e.say(t)},s=function(){if(e.hideTokenRadialMenu(),e.hideTokenContextMenu(),i)for(var t=0,r=n;t<r.length;t++){var o=r[t];e.addTokenToSelection(o)}};if(0===r){for(var u=0,c=n;u<c.length;u++){var l=c[u];a(l)}s()}else for(var d=r,f=function(e){setTimeout(function(){a(n[e]),e+1===n.length&&s()},d),d+=r},p=0;p<n.length;p++)f(p)}}(r||(r={})),n.R20=r},6:function(e,n,t){"use strict";n.__esModule=!0;var r=t(8);n.copy=function(e,n){var t=Object.assign({},e);return n&&(t=Object.assign(t,n)),t};var i=function(e){if("currentTransform"in e)return e.currentTransform;if("getTransform"in e)return e.getTransform();if(e.mozCurrentTransform){var n=e.mozCurrentTransform;return{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}}};n.getTransform=i,n.nearly_format_file_url=function(e){var n="";try{var t=function(e,n){var t=e.indexOf(n);return t>0?e.substring(0,t):e},r=e.lastIndexOf("/");n=t(n=t(n=t(n=e.substring(r+1),"."),"?"),"#"),n=decodeURIComponent(n)}catch(t){n=e}return n};n.getRotation=function(e){var n=i(e),t=Math.atan2(n.b,n.a);return t<0&&(t+=2*Math.PI),t};n.findByIdAndRemove=function(e){var n=document.getElementById(e);n&&n.remove()};n.mapObj=function(e,n){return Object.keys(e).reduce(function(t,r){var i=n(e[r],r);return void 0!==i&&null!==i&&t.push(i),t},[])};n.safeCall=function(e){try{e()}catch(e){console.error(e)}};n.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)};n.replaceAll=function(e,n,t){return e.replace(new RegExp(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(n),"g"),t)};n.safeParseJson=function(e){try{return JSON.parse(e)}catch(e){alert("File is not a valid JSON file.")}return null};n.readFile=function(e){return new Promise(function(n,t){if(e){var r=new FileReader;r.readAsText(e),r.onload=function(e){n(e.target.result)}}else t("No file given.")})};var o=function(){return chrome||browser};n.getBrowser=o;n.injectScript=function(e){console.log("Injecting "+e);var n=document.createElement("script");n.async=!1,n.src=o().extension.getURL(e),n.onload=function(){n.remove()},document.head.appendChild(n)};n.strIsNullOrEmpty=function(e){return null===e||void 0===e||e.length<=0||e.trim().length<=0};n.createCSSElement=function(e,n){var t=document.createElement("style");return t.innerHTML=e,t.id=n,t};n.getExtUrlFromPage=function(e,n){var t=void 0===n||null===n?1e3:n;return new Promise(function(n,i){try{var o=!1,a=function(){window.removeEventListener("message",u)},s=window.generateUUID(),u=function(e){e.origin===r.Config.appUrl&&e.data.r20esGivesResourceUrl&&e.data.r20esGivesResourceUrl.id===s&&(o=!0,a(),n(e.data.r20esGivesResourceUrl.url))};window.addEventListener("message",u);var c={resource:e,id:s};window.postMessage({r20esWantsResourceUrl:c},r.Config.appUrl),setTimeout(function(){try{o||(a(),i("Timed out after "+t+"ms"))}catch(e){i(e)}},t)}catch(e){i(e)}})}},7:function(e,n,t){"use strict";n.__esModule=!0;var r=function(){function e(e,n,t){this._isSubscribed=!1,this._name=e,this._callback=n,this._targetGetter=t}return e.subscribe=function(n,t,r){var i=new e(n,t,r);return i.subscribe(),i},e.prototype.subscribe=function(){if(!this._isSubscribed){var e=this._targetGetter();"on"in e?e.on(this._name,this._callback):e.addEventListener(this._name,this._callback),this._isSubscribed=!0}},e.prototype.unsubscribe=function(){if(this._isSubscribed){var e=this._targetGetter();"off"in e?e.off(this._name,this._callback):e.removeEventListener(this._name,this._callback),this._isSubscribed=!1}},e}();n.EventSubscriber=r},77:function(e,n,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};n.__esModule=!0;var i=function(){function e(){}return e.status_span_base={visibility:"visible",background:"#e44949",color:"white",padding:"4px","border-radius: ":"5px","font-weight":"bold","border-radius":"4px",height:"1.4em","text-align":"center"},e.error_span=r({},e.status_span_base,{background:"#e44949"}),e.success_span=r({},e.status_span_base,{background:"rgb(91, 177, 10)"}),e.progress_span=r({},e.status_span_base,{background:"rgb(212, 186, 55)"}),e}();n.CommonStyle=i},78:function(e,n,t){"use strict";n.__esModule=!0,n.scaleToFit=function(e,n,t,r){var i=e/n,o=i*r;return o>t?{x:t,y:t/i}:{x:o,y:r}}},79:function(e,n,t){"use strict";n.__esModule=!0;var r=function(e,n,t,r){-1===n?console.warn("Tried to "+t+" but couldn't find object!",e,r):e.splice(n,1)};n.removeByReference=function(e,n){var t=e.findIndex(function(e){return e==n});r(e,t,"remove by reference",n)},n.removeOnceByPredicate=function(e,n){var t=e.findIndex(n);r(e,t,"remove once by predicate",n)}},8:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Config=void 0;let r={};n.Config=r,r.appUrl="https://app.roll20.net",r.websiteFeatureUrlTemplate="https://justas-d.github.io/roll20-enhancement-suite/features#",r.website="https://justas-d.github.io/roll20-enhancement-suite/",r.discordInvite="https://discord.gg/pKxxvuM",r.contributeUrl="https://justas-d.github.io/roll20-enhancement-suite/contribute.html"}});