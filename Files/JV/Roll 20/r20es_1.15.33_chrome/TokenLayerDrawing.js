!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=162)}({162:function(e,n,t){"use strict";(function(e){var o=this&&this.__extends||function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function o(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();n.__esModule=!0;var i=t(4),r=t(5),a=t(28),s=Math.PI/180,l=function(n){function t(){var t=n.call(this,e)||this;return t.drawOverlay=function(e,n){var o;try{var i=t.getHook().config,l=((o={})[r.R20.CanvasLayer.GMTokens]=i.drawOnGmLayer,o[r.R20.CanvasLayer.PlayerTokens]=i.drawOnTokenLayer,o[r.R20.CanvasLayer.Map]=i.drawOnMapLayer,o[r.R20.CanvasLayer.Lighting]=i.drawOnLightsLayer,o[r.R20.CanvasLayer.B20Weather]=i.drawOnWeatherLayer,o[r.R20.CanvasLayer.B20Foreground]=i.drawOnForegroundLayer,o[r.R20.CanvasLayer.B20Background]=i.drawOnBackgroundLayer,o),u=r.R20.try_get_canvas_object_model(n);if(!u)return;var d=u.get("layer");if(!l[d])return;var c=a.layerInfo[d];e.save();var f=e.globalAlpha,g=e.lineWidth,w=e.fillStyle,h=e.strokeStyle,p=e.font;if(e.globalAlpha=i.globalAlpha,e.lineWidth=i.textStrokeWidth,!i.rotateAlongWithToken){var b=n.flipY^n.flipX?1:-1;e.rotate(b*n.angle*s)}n.flipX&&e.scale(-1,1),n.flipY&&e.scale(1,-1);var v=i.textFontSize;e.font="bold "+v+"px Arial";var y=e.measureText(c.txt).width,m=.08*y,C=.18*y,_=Math.floor(n.get("width")/2)-y,k=Math.floor(n.get("height")/2);window.r20es.is_drawing_bars_at_the_bottom&&n._bar_data&&(k-=n._bar_data.height*n._bar_data.to_render.length+3),e.fillStyle="rgba("+c.bgColors[0]+", "+c.bgColors[1]+", "+c.bgColors[2]+", "+i.backgroundOpacity+")",e.fillRect(_-.5*C,k-v,y+C,v),e.strokeStyle="rgba("+i.textStrokeColor[0]+", "+i.textStrokeColor[1]+", "+i.textStrokeColor[2]+", "+i.textStrokeOpacity+")",e.fillStyle="rgba("+i.textFillColor[0]+", "+i.textFillColor[1]+","+i.textFillColor[2]+", "+i.textFillOpacity+")",e.strokeText(c.txt,_,k-m),e.fillText(c.txt,_,k-m),e.restore(),e.globalAlpha=f,e.lineWidth=g,e.fillStyle=w,e.strokeStyle=h,e.font=p}catch(e){console.error(e)}},t}return o(t,n),t.prototype.onSettingChange=function(e,n,t){r.R20.renderAll()},t.prototype.setup=function(){r.R20.isGM()&&(window.r20es.tokenDrawBg=this.drawOverlay,r.R20.renderAll())},t.prototype.dispose=function(){window.r20es.tokenDrawBg=null,r.R20.renderAll()},t}(i.R20Module.SimpleBase);i.R20Module.canInstall()&&(new l).install()}).call(this,"src/modules/TokenLayerDrawing")},28:function(e,n,t){"use strict";var o;n.__esModule=!0;var i=t(5);n.layerInfo=((o={})[i.R20.CanvasLayer.Map]={bigTxt:"Page Background",txt:"MP",bgColors:[255,255,0],toolName:"choosemap"},o[i.R20.CanvasLayer.PlayerTokens]={bigTxt:"Tokens (Player Visible)",txt:"TK",bgColors:[255,0,0],toolName:"chooseobjects"},o[i.R20.CanvasLayer.GMTokens]={bigTxt:"Game Master Tokens",txt:"GM",bgColors:[0,255,0],toolName:"choosegmlayer"},o[i.R20.CanvasLayer.Lighting]={bigTxt:"Lighting",txt:"LG",bgColors:[0,255,255],toolName:"choosewalls"},o[i.R20.CanvasLayer.B20Foreground]={bigTxt:"Page Foreground",txt:"FG",bgColors:[229,137,25],toolName:"chooseforeground"},o[i.R20.CanvasLayer.B20Weather]={bigTxt:"Weather",txt:"WH",bgColors:[65,24,229],toolName:"chooseweather"},o[i.R20.CanvasLayer.B20Background]={bigTxt:"B20 Background",txt:"BG",bgColors:[208,69,247],toolName:"choosebackground"},o),n.makeLayerButtonSelector=function(e){return"#editinglayer li."+e.toolName}},3:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=(e=>{const n=e.replace(/\\/g,"/").split("/");if(n.length<=0)throw new Error("Invalid dirname given.");return n[n.length-1]+".js"})},4:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.R20Module=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(t(3));function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n}let a={};n.R20Module=a,a.Base=function(){function e(e){!function(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}(this,"getAllHooks",e=>window.r20es.hooks),this.filename=(0,o.default)(e),this.isDisposed=!0}var n=e.prototype;return n.installFirstTime=function(){},n.installUpdate=function(){},n.dispose=function(){},n.internalCanInstall=function(){return!!this.getHook().config.enabled&&(!!this.isDisposed||(console.error("Attempted to install module when it's not disposed."),console.table({"Module filename":this.filename}),console.trace(),!1))},n.internalInstallFirstTime=function(){if(this.internalCanInstall()){try{this.installFirstTime()}catch(e){console.error(e)}this.isDisposed=!1}},n.internalInstallUpdate=function(){if(this.internalCanInstall()){try{this.installUpdate()}catch(e){console.error(e)}this.isDisposed=!1}},n.internalDispose=function(){if(console.log(this),this.isDisposed)return console.error("internalDispose called on module that is already disposed!"),console.table({"Module filename":this.filename}),void console.trace();try{this.dispose()}catch(e){console.error(e)}this.isDisposed=!0},n.setConfigValue=function(e,n){const t=this.getHook(),o=this.getHook().config;if(!(e in o))return void console.error(`Tried to set config of key ${e} to value ${n} but key was not found in the config of module id ${t.id}"`);const i=o[e];o[e]=n,t.saveConfig(),o.enabled&&"onSettingChange"in this&&"function"==typeof this.onSettingChange&&this.onSettingChange(e,i,n)},n.getHook=function(){if(!1 in window.r20es)return null;for(const e in window.r20es.hooks){const n=window.r20es.hooks[e];if(n.filename&&n.filename===this.filename)return n}return null},n.toggleEnabledState=function(e){const n=this.getHook(),t=void 0===e||null===e?!n.config.enabled:e;if(n.config.enabled&&t)return;const o=n.config.enabled;n.config.enabled=t,n.saveConfig(),o&&!t?(console.log("disabling"),this.internalDispose()):!o&&t&&(console.log("enabling"),this.internalInstallUpdate())},n.install=function(){if(!("r20esInstalledModuleTable"in window))return;if(!("r20esDisposeTable"in window))return;console.log(`Installing module filename: ${this.filename}`),!(this.filename in window.r20esInstalledModuleTable)?(console.log("First run"),this.internalInstallFirstTime()):(this.filename in window.r20esDisposeTable&&console.error(`DUPLICATE MODULE FOUND: ${this.filename}`),console.log("Calling install update"),this.internalInstallUpdate()),window.r20esDisposeTable[this.filename]=(()=>{this.dispose()}),window.r20esInstalledModuleTable[this.filename]=this,console.log(`DONE! module ID: ${this.filename}`)},e}(),a.SimpleBase=function(e){function n(){return e.apply(this,arguments)||this}r(n,e);var t=n.prototype;return t.installFirstTime=function(){this.setup()},t.installUpdate=function(){this.setup()},t.setup=function(){},n}(a.Base),a.OnAppLoadBase=function(e){function n(n){var t;return(t=e.call(this,n)||this).setup=t.setup.bind(i(i(t))),t}r(n,e);var t=n.prototype;return t.installFirstTime=function(){window.r20es.isLoading?(this.earlySetup(),window.r20es.onAppLoad.addEventListener(this.setup)):(this.earlySetup(),this.setup())},t.earlySetup=function(){},t.setup=function(){},t.installUpdate=function(){this.installFirstTime()},t.dispose=function(){window.r20es.onAppLoad.removeEventListener(this.setup)},n}(a.Base),a.canInstall=(e=>window.r20es&&"canInstallModules"in window.r20es&&window.r20es.canInstallModules),a.getModule=function(e){return"r20esInstalledModuleTable"in window?window.r20esInstalledModuleTable[e]:null},a.getModuleById=function(e){return"r20esInstalledModuleTable"in window?a.getModule(window.r20es.hooks[e].filename):null}},5:function(e,n,t){"use strict";n.__esModule=!0;var o,i=t(7);!function(e){var n;function t(){return window.d20.engine.unselect()}function o(e){window.d20.engine.select(e)}function r(){return window.currentPlayer}function a(){return window.currentEditingLayer}function s(){try{var e=window.d20.Campaign.attributes.jukeboxfolder;return JSON.parse(e||"[]")}catch(e){console.error("[getJukeboxFileStructure] failed to get fs due to exception",e)}return[]}function l(e){return window.Jukebox.playlist.get(e)}function u(){return window.d20.Campaign.activePage()}function d(){return window.d20.engine.canvas.getObjects()}function c(n){for(var t=0,o=d();t<o.length;t++){var i=o[t],r=e.try_get_canvas_object_model(i);if(r&&r.get("id")===n)return i}return null}function f(e,n,t){t?($(document).on("mancerroll:"+n,function(e,o){$(document).off("mancerroll:"+n),t(e,o)}),window.d20.textchat.doChatInput(e,"chatbox",n)):window.d20.textchat.doChatInput(e)}function g(e){window.d20.textchat.incoming(!1,{who:"system",type:"system",content:e})}function w(){window.d20.engine.redrawScreenNextTick(!1)}!function(e){e[e.NumericAscending=0]="NumericAscending",e[e.NumericDescending=1]="NumericDescending",e[e.Alphabetical=2]="Alphabetical",e[e.AlphabeticalDescending=3]="AlphabeticalDescending",e[e.Card=4]="Card"}(n=e.InitiativeOrdering||(e.InitiativeOrdering={})),function(e){e.Map="map",e.PlayerTokens="objects",e.GMTokens="gmlayer",e.Lighting="walls",e.B20Foreground="foreground",e.B20Weather="weather",e.B20Background="background"}(e.CanvasLayer||(e.CanvasLayer={})),e.setBackgroundStyle=function(e){window.d20.engine.backgroundColor=e},e.setupImageDropTarget=function(e,n,t){var o={model:{save:n},updateModel:t};window.d20.utils.setupAvatar(e,o)},e.getCanvasMousePos=function(){return window.d20.engine.mousePos.slice()},e.onInitiativeChange=function(n){return new i.EventSubscriber("change:turnorder",n,function(){return e.getInitiativeWindow().model})},e.setCanvasObjectLocation=function(n,t,o){var i=e.try_get_canvas_object_model(n);i&&i.save({top:o,left:t})},e.getBlob=function(e,n,t){return void 0===t&&(t=5e3),new Promise(function(o,i){e._getLatestBlob(n,o),setTimeout(i,t)})},e.getCampaign=function(){return window.Campaign},e.canEditCharacter=function(n){var t=n.attributes.controlledby;return!!e.isGM()||(!!t.includes("all")||!!t.includes(e.getCurrentPlayer().id))},e.getHandout=function(e){return window.Campaign.handouts.get(e)},e.createCharacter=function(e){return window.Campaign.characters.create(e)},e.setCanvasObjectDimensions=function(n,t,o){var i=e.try_get_canvas_object_model(n);i&&i.save({width:t,height:o})},e.getCharacter=function(e){return window.Campaign.characters.get(e)},e.getAllCharacters=function(){return window.Campaign.characters.models},e.getAllPages=function(){return window.Campaign.pages.models},e.createRollableTable=function(e){return window.d20.Campaign.rollabletables.create(e)},e.getRollableTable=function(e){return window.d20.Campaign.rollabletables.get(e)},e.getSelectedTokens=function(){return window.d20.engine.selected()},e.unselectTokens=t,e.addTokenToSelection=o,e.selectToken=function(e){t(),o(e)},e.hideTokenRadialMenu=function(){window.d20.token_editor.removeRadialMenu()},e.hideTokenContextMenu=function(){window.d20.token_editor.closeContextMenu()},e.getCurrentPlayer=r,e.getCanvasZoom=function(){return window.d20.engine.canvasZoom},e.getCanvasWidth=function(){return window.d20.engine.canvas.width},e.getCanvasHeight=function(){return window.d20.engine.canvas.height},e.getCanvasOffsetX=function(){return window.d20.engine.currentCanvasOffset[0]},e.getCanvasOffsetY=function(){return window.d20.engine.currentCanvasOffset[1]},e.getPageById=function(e){return window.Campaign.pages.get(e)},e.isGM=function(){return window.is_gm},e.getCurrentLayer=a,e.generateUUID=function(){return window.generateUUID()},e.getCurrentToolName=function(){return window.d20.engine.mode},e.advanceInitiative=function(){window.d20.Campaign.initiativewindow.nextTurn()},e.addTokenToInitiative=function(e){window.d20.Campaign.initiativewindow.addTokenToList(e)},e.addCustomItemToInitiative=function(e,n){window.d20.Campaign.initiativewindow.addTokenToList("-1",e,n)},e.rerenderMacroBar=function(){window.d20.player_settings.refreshMacroBar()},e.rerenderJournalMacros=function(){window.d20.player_settings.refreshRollsList()},e.orderInitiativeBy=function(e){var t,o=((t={})[n.NumericAscending]=".sortlist_numeric",t[n.NumericDescending]=".sortlist_numericdesc",t[n.Alphabetical]=".sortlist_alpha",t[n.AlphabeticalDescending]=".sortlist_alphadesc",t[n.Card]=".sortlist_card",t);if(e in o){var i=o[e];$("#initiativewindow_settings").dialog({modal:!1,title:"Turn Order Settings",beforeClose:function(){}}),$(i).click()}else console.error("Invalid initiative ordering: "+e)},e.getInitiativeWindow=function(){return window.d20.Campaign.initiativewindow},e.getJukeboxFileStructure=s,e.setJukeboxFileStructure=function(n){e.getCampaign().save({jukeboxfolder:JSON.stringify(n)})},e.createPlaylist=function(e){return window.d20.jukebox.addFolderToFolderStructure(e)},e.addTrackToPlaylist=function(e,n){return window.d20.jukebox.addItemToFolderStructure(e,n)},e.getSongById=l,e.getJukeboxPlaylists=function(){for(var e=[],n=0,t=s();n<t.length;n++){var o=t[n];if("string"!=typeof o){for(var i=o,r={id:i.id,name:i.n,mode:i.s,songs:[]},a=0,u=i.i;a<u.length;a++){var d=u[a],c=l(d);c?r.songs.push(c):console.warn("Tried to get song id "+d+" but the query returned a falsy value. Skipping")}e.push(r)}}return e},e.playAudio=function(e,n){window.Jukebox.soundObjs[e]=window.soundManager.createSound({id:e,url:n})},e.createSong=function(e){return window.Jukebox.playlist.create(e)},e.makePlaylistStructure=function(e,n,t){return{id:window.generateUUID(),n:e,s:n,i:t||[]}},e.getInitiativeData=function(){return window.d20.Campaign.initiativewindow.cleanList()},e.setInitiativeData=function(e){window.d20.Campaign.initiativewindow.model.save({turnorder:JSON.stringify(e)})},e.getCurrentPage=u,e.getCurrentPageTokens=d,e.doesTokenContainMouse=function(e,n){return window.d20.engine.canvas.containsPoint(e,n)},e.getCurrentPageTokenByUUID=c,e.try_get_canvas_object_model=function(e){return e._model?e._model:e.model?e.model:null},e.isUsing5EOGLSheet=function(){try{return window.d20.journal.customSheets.workerScripts[0].includes("5th Edition OGL by Roll20")}catch(e){return!1}},e.moveCameraToTokenByUUID=function(e){if(e){var n=c(e);if(n){var t=$("#editor-wrapper")[0];t.scrollTop=Math.floor(n.top*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasHeight/2)+125*window.d20.engine.canvasZoom,t.scrollLeft=Math.floor(n.left*window.d20.engine.canvasZoom)-Math.floor(window.d20.engine.canvasWidth/2)+125*window.d20.engine.canvasZoom}}},e.primitiveSay=function(e,n){window.d20.textchat.doChatInput(e,n)},e.say=f,e.sayToSelf=function(n,t){var o='/w "'+r().get("displayname")+'" '+n;t?f(o,e.generateUUID(),t):f(o)},e.saySystemRaw=g,e.saySystem=function(e){g('<span style="background: rgba(6,26,45,255);\n    color: whitesmoke;\n    border: none;\n    display: inline-block;\n    padding: 8px;\n    margin: -15px -5px -7px -45px;    \n    "\n>\n'+e+"\n</span>\n        ")},e.ping=function(e,n,t,o,i){t=t||r().id,window.d20.engine.pings[t]={left:e,top:n,radius:-5,player:t,pageid:o||u().id,currentLayer:i||a()},window.d20.engine.pinging={downx:e,downy:n},w()},e.getFabric=function(){return window.exports.fabric},e.renderAll=w,e.setGMLayerOpacity=function(e){window.d20.engine.gm_layer_opacity=e},e.hasBetteR20=function(){return void 0!==window.d20plus},e.wipeObjectStorage=function(e){for(var n=e.length,t=0;t<n;t++){var o=e.length-1;if(0>o)break;var i=e.models[o];if(!i||void 0===i)break;i.destroy()}e.length<0&&console.error("FAILED TO WIPE OBJECT STORAGE!")},e.doBulkRoll=function(n,t,o,i,r){e.unselectTokens();var a=function(n){if(e.selectToken(n),r){var o=r(n);o&&e.say(t,o.id,o.callback)}else e.say(t)},s=function(){if(e.hideTokenRadialMenu(),e.hideTokenContextMenu(),i)for(var t=0,o=n;t<o.length;t++){var r=o[t];e.addTokenToSelection(r)}};if(0===o){for(var l=0,u=n;l<u.length;l++){var d=u[l];a(d)}s()}else for(var c=o,f=function(e){setTimeout(function(){a(n[e]),e+1===n.length&&s()},c),c+=o},g=0;g<n.length;g++)f(g)}}(o||(o={})),n.R20=o},7:function(e,n,t){"use strict";n.__esModule=!0;var o=function(){function e(e,n,t){this._isSubscribed=!1,this._name=e,this._callback=n,this._targetGetter=t}return e.subscribe=function(n,t,o){var i=new e(n,t,o);return i.subscribe(),i},e.prototype.subscribe=function(){if(!this._isSubscribed){var e=this._targetGetter();"on"in e?e.on(this._name,this._callback):e.addEventListener(this._name,this._callback),this._isSubscribed=!0}},e.prototype.unsubscribe=function(){if(this._isSubscribed){var e=this._targetGetter();"off"in e?e.off(this._name,this._callback):e.removeEventListener(this._name,this._callback),this._isSubscribed=!1}},e}();n.EventSubscriber=o}});